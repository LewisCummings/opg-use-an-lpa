{% extends '@actor/layout.html.twig' %}

{% block html_title %}Check Access Codes {{ parent() }} {% endblock %}

{% block content %}

    <div class="govuk-width-container">
        {{ include('@partials/new-service.html.twig') }}

        {{ include('@partials/account-bar.html.twig') }}

        <a href="{{ path('lpa.dashboard', {}, {'lpa': actorToken}) }}" class="govuk-back-link">Back</a>

        <main class="govuk-main-wrapper">

            <div class="govuk-grid-row">
                <div class="govuk-grid-column-one-third">
                <span class="govuk-caption-l">
                    {% if lpa.caseSubtype == "pfa" %}
                        Property and Finance
                    {% else %}
                        Health and Welfare
                    {% endif %}
                </span>
                    <h1 class="govuk-heading-l">{{ lpa.donor.firstname }} {{ lpa.donor.surname }}</h1>
                </div>
            </div>

            {{ include('@actor/partials/lpa-sub-navigation.html.twig') }}

            <div class="govuk-grid-row">
                <div class="govuk-grid-column-two-thirds">
                    <h2 class="govuk-heading-xl">Check access codes</h2>

                    <h2 class="govuk-heading-m">Active codes</h2>

                    <p class="govuk-body">Give an organisation their access code so they can view this LPA.<br>
                        They should go to www.gov.uk/view-an-lpa to use the code.</p>

                    {% set allActive = true %}

                    {% for code in shareCodes %}

                    {% if check_if_code_has_expired(code.Expires|date("Y/m/d", false)) == true %}
                        {% set allActive = false %}
                    {% endif %}
                    {% endfor %}

                    <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">

                        {% for code in shareCodes %}
                            {% if check_if_code_has_expired(code.Expires|date("Y/m/d", false)) == false %}
                                {{ include('@actor/partials/check-code-details.html.twig') }}
                            {% endif %}
                        {% endfor %}
                    </div>

                    {% if allActive == false %}
                        <h2 class="govuk-heading-m">Inactive codes</h2>

                        <p class="govuk-body">The following codes will no longer work.<br>
                            Make a new code if an organisation below still needs access to this LPA.</p>

                        <div class="govuk-accordion" data-module="govuk-accordion" id="accordion-default">

                            {% for code in shareCodes %}
                                {% if check_if_code_has_expired(code.Expires|date("Y/m/d", false)) == true %}
                                    {{ include('@actor/partials/check-code-details.html.twig') }}
                                {% endif %}
                            {% endfor %}
                        </div>
                    {% endif %}

                </div>
            </div>
        </main>
    </div>

{% endblock %}